#!/usr/bin/env bash
set -euo pipefail

# ---- Configuration ----
# Logo-Width
# Use half of Logo-Size
LOGO_W=20

# Gap between logo and info-block.
LOGO_GAP=2

# Figlet Font
FIGLET_FONT="small_slant"

# Optional: overrite OS-Text (leave empty = use fastfetch os info)
OVERRIDE_TITLE=""

# ---- Check dependencies ----
need() { command -v "$1" >/dev/null 2>&1 || { echo "Missing: $1" >&2; exit 1; }; }
need fastfetch
need jq
need pyfiglet
need lolcat
need tput
need awk
need sed
need sort
need head

# ---- Set Title ----
if [[ -n "${OVERRIDE_TITLE}" ]]; then
  TITLE="${OVERRIDE_TITLE}"
else
  TITLE="$(fastfetch -s os --format json | jq -r '.[0].result.name')"
fi

# ---- Render Figlet ----
FIGLET="$(pyfiglet -s -f "${FIGLET_FONT}" "${TITLE}")"

TERM_COLS="$(tput cols)"
LOGO_AREA=$((LOGO_W + LOGO_GAP))

# Define max char-length for Figlet-Outputs
FIGLET_W="$(printf '%s\n' "${FIGLET}" | awk '{print length}' | sort -nr | head -n1)"

# Centering in Info-Block
CENTER_IN_INFO=$(( (LOGO_AREA - FIGLET_W) / 2 ))
if (( CENTER_IN_INFO < 0 )); then CENTER_IN_INFO=0; fi

# Sum of Indents = Logo-Space + Centering in Info-Block
PAD=$((LOGO_AREA + CENTER_IN_INFO))

# Output
printf '%s\n' "${FIGLET}" | sed "s/^/$(printf '%*s' "${PAD}")/" | lolcat
echo
fastfetch
